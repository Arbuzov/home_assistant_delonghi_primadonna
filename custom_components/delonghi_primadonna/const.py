"""Constant values and command templates for the integration.

These bytes sequences represent the device protocol messages used to
control the machine and decode its responses.
"""
from homeassistant.const import EntityCategory

DOMAIN = 'delonghi_primadonna'

SERVICE = '00035b03-58e6-07dd-021a-08123a000300'

CONTROLL_CHARACTERISTIC = '00035b03-58e6-07dd-021a-08123a000301'

NAME_CHARACTERISTIC = '00002A00-0000-1000-8000-00805F9B34FB'

DESCRIPTOR = '00002902-0000-1000-8000-00805f9b34fb'

DEFAULT_IMAGE_URL = (
    'https://delonghibe.s3.eu-west-1.amazonaws.com/cms/prod/img/'
    '_opt_delonghi_uploads_PD_CLASS_TOP_INT_ECAM550.85.MS.png'
)

BEVERAGE_SERVICE_NAME = 'make_beverage'

# Mapping of profile id to profile name
AVAILABLE_PROFILES = {
    1: 'Profile 1',
    2: 'Profile 2',
    3: 'Profile 3',
    4: 'Guest',
}

POWER_OFF_OPTIONS = {
    '15min': 0,
    '30min': 1,
    '1h': 2,
    '2h': 3,
    '3h': 4
}

ENTITY_CATEGORY = {
    'None': None,
    'Configuration': EntityCategory.CONFIG,
    'Diagnostic': EntityCategory.DIAGNOSTIC,
}

"""
Command bytes
"""
BYTES_POWER = [0x0d, 0x07, 0x84, 0x0f, 0x02, 0x01, 0x55, 0x12]

# Default bitmask for commands
BASE_COMMAND = '10000001'

# Mask used when requesting statistical parameters
STATISTICS_PARAM_MASK = 0x0F

# Template command for requesting statistical parameters (0xA2)
BYTES_STATISTICS_REQUEST = [
    0x0D,
    0x08,
    0xA2,
    STATISTICS_PARAM_MASK,
    0x00,
    0x00,
    0x00,
    0x00,
    0x00,
]

# (address, number of parameters) pairs to request from the device.
STATISTICS_BLOCKS: list[tuple[int, int]] = [
    (160, 10),
    (170, 10),
    (180, 10),
    (150, 10),
    (190, 4),
    (110, 10),
    (120, 10),
    (130, 10),
    (140, 10),
    (100, 10),
    (50, 10),
    (60, 7),
    (200, 10),
    (250, 9),
]

# This command change device switches
BYTES_SWITCH_COMMAND = [
    0x0d, 0x0b, 0x90, 0x0f, 0x00, 0x3f,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00
]

BYTES_AUTOPOWEROFF_COMMAND = [
    0x0d, 0x0b, 0x90, 0x0f, 0x00, 0x3e,
    0x00, 0x00, 0x00, 0x00, 0x81, 0xe3
]

BYTES_WATER_HARDNESS_COMMAND = [
    0x0d, 0x0b, 0x90, 0x0f, 0x00, 0x32,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00
]

BYTES_WATER_TEMPERATURE_COMMAND = [
    0x0d, 0x0b, 0x90, 0x0f, 0x00, 0x3d,
    0x00, 0x00, 0x00, 0x00, 0x6f, 0x31
]

# Commands that load user profiles from the device. They must be
# executed once after the first successful connection. The CRC
# bytes are zeros as they are calculated at runtime.
BYTES_LOAD_PROFILES = [0x0d, 0x07, 0xa4, 0xf0, 0x01, 0x06, 0x00, 0x00]
BYTES_LOAD_PROFILES_1 = [0x0d, 0x07, 0xa4, 0xf0, 0x01, 0x03, 0x00, 0x00]
BYTES_LOAD_PROFILES_2 = [0x0d, 0x07, 0xa4, 0xf0, 0x04, 0x06, 0x00, 0x00]

COFFE_ON = [0x0d, 0x0f, 0x83, 0xf0, 0x02, 0x01, 0x01,
            0x00, 0x67, 0x02, 0x02, 0x00, 0x00, 0x06, 0x77, 0xff]
COFFE_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x02, 0x02, 0x06, 0xc4, 0xb1]

DOPPIO_ON = [0x0d, 0x0d, 0x83, 0xf0, 0x05, 0x01, 0x01,
             0x00, 0x78, 0x00, 0x00, 0x06, 0xc4, 0x7e]
DOPPIO_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x05, 0x02, 0x06, 0x41, 0x21]

STEAM_ON = [0x0d, 0x0d, 0x83, 0xf0, 0x11, 0x01,
            0x09, 0x03, 0x84, 0x1c, 0x01, 0x06, 0xc0, 0x7b]
STEAM_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x11, 0x02, 0x06, 0xde, 0x82]

HOTWATER_ON = [0x0d, 0x0d, 0x83, 0xf0, 0x10, 0x01,
               0x0f, 0x00, 0xfa, 0x1c, 0x01, 0x06, 0x04, 0xb4]
HOTWATER_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x10, 0x02, 0x06, 0xe9, 0xb2]

ESPRESSO2_ON = [0x0d, 0x0f, 0x83, 0xf0, 0x04, 0x01, 0x01,
                0x00, 0x28, 0x02, 0x02, 0x00, 0x00, 0x06, 0xab, 0x53]
ESPRESSO2_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x04, 0x02, 0x06, 0x76, 0x11]

AMERICANO_ON = [0x0d, 0x12, 0x83, 0xf0, 0x06, 0x01, 0x01, 0x00,
                0x28, 0x02, 0x03, 0x0f, 0x00, 0x6e, 0x00, 0x00,
                0x06, 0x47, 0x8b]
AMERICANO_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x06, 0x02, 0x06, 0x18, 0x71]

LONG_ON = [0x0d, 0x0f, 0x83, 0xf0, 0x03, 0x01, 0x01,
           0x00, 0xa0, 0x02, 0x03, 0x00, 0x00, 0x06, 0x18, 0x7f]
LONG_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x03, 0x02, 0x06, 0xf3, 0x81]

# Espresso x1 (Aroma=3 Temperature=2 Qty=40)
ESPRESSO_ON = [0x0d, 0x11, 0x83, 0xf0, 0x01, 0x01, 0x01, 0x00,
               0x28, 0x02, 0x03, 0x08, 0x00, 0x00, 0x00, 0x06, 0x8f, 0xfc]
ESPRESSO_OFF = [0x0d, 0x08, 0x83, 0xf0, 0x01, 0x02, 0x06, 0x9d, 0xe1]

# This commands return the current device state
DEBUG = [0x0d, 0x05, 0x75, 0x0f, 0xda, 0x25]

"""
Status bytes
"""
WATER_TANK_DETACHED = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x15, 0x00, 0x00,
                       0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                       0xaa, 0x31]

WATER_SHORTAGE = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x45, 0x00, 0x01, 0x00,
                  0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x64]

WATER_SHORTAGE2 = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x41, 0x00, 0x05, 0x00,
                   0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x4e]

GRAINS_SHORTAGE = []

CRAINS_COVER_OPENED = []

COFFEE_GROUNDS_CONTAINER_FULL = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x05, 0x00,
                                 0x02, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00,
                                 0x00, 0x00, 0x00, 0x43, 0xd0]

# On some devices the grounds container clean notification includes an
# additional bit in the general notification field. Handle it as the same
# "GroundsContainerFull" status.
COFFEE_GROUNDS_CONTAINER_CLEAN = [
    0xd0, 0x12, 0x75, 0x0f, 0x01, 0x05, 0x00, 0x0a, 0x00, 0x07, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0xa0
]

COFFEE_GROUNDS_CONTAINER_DETACHED = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x0d, 0x00,
                                     0x00, 0x00, 0x07, 0x00, 0x00,
                                     0x00, 0x00, 0x00, 0x00, 0x00, 0x86, 0xc9]

DEVICE_READY = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x05, 0x00, 0x00,
                0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x9d, 0x61]

DEVICE_TURNOFF = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x01, 0x00, 0x00,
                  0x00, 0x00, 0x03, 0x64, 0x00, 0x00, 0x00, 0x00,
                  0x00, 0xd6, 0x96]

START_COFFEE = [0xd0, 0x12, 0x75, 0x0f, 0x01, 0x05, 0x00, 0x00,
                0x00, 0x07, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x00, 0x5c, 0xa7]
